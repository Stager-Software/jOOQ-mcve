DROP DATABASE IF EXISTS mcve;

CREATE DATABASE mcve;

CREATE TABLE mcve.test (
  id INT NOT NULL AUTO_INCREMENT,
  cd INT,
  
  CONSTRAINT pk_test PRIMARY KEY (id) 
);

CREATE TABLE mcve.`Organization` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `createdAt` datetime NOT NULL,
  `modifiedAt` datetime NOT NULL,
  `name` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE mcve.`Account` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `modifiedAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `firstName` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `lastName` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `emailAddress` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL,
  `organization_id` bigint NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `UIX_Account__emailAddress__organization_id__active` (`emailAddress`,`organization_id`),
  KEY `FK_Account__organization_id` (`organization_id`),
  CONSTRAINT `FK_Account__organization_id` FOREIGN KEY (`organization_id`) REFERENCES `Organization` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE mcve.`User` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `modifiedAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `account_id` bigint NOT NULL,
  `activatedAt` datetime DEFAULT NULL,
  `deleted` bit(1) NOT NULL DEFAULT b'0',
  `organization_id` bigint NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `UIX_User__account_id` (`account_id`),
  KEY `IX_User__organization_id` (`organization_id`),
  CONSTRAINT `FK_User__organization_id` FOREIGN KEY (`organization_id`) REFERENCES `Organization` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE mcve.`UserPreference` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `createdAt` datetime NOT NULL,
  `modifiedAt` datetime NOT NULL,
  `organization_id` bigint NOT NULL,
  `user_id` bigint NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `UIX_UserPreference__user_id` (`user_id`),
  KEY `IX_UserPreference__organization_id` (`organization_id`),
  KEY `IX_UserPreference__user_id` (`user_id`),
  CONSTRAINT `FK_UserPreference__organization_id` FOREIGN KEY (`organization_id`) REFERENCES `Organization` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `FK_UserPreference__user_id` FOREIGN KEY (`user_id`) REFERENCES `User` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE mcve.`UserPreference_ScheduleFilterUser` (
  `userPreference_id` bigint NOT NULL,
  `user_id` bigint NOT NULL,
  PRIMARY KEY (`userPreference_id`,`user_id`),
  KEY `IX_UserPreference_ScheduleFilterUser__userPreference_id` (`userPreference_id`),
  KEY `IX_UserPreference_ScheduleFilterUser__user_id` (`user_id`),
  CONSTRAINT `FK_UserPreference_ScheduleFilterUser__user_id` FOREIGN KEY (`user_id`) REFERENCES `User` (`id`) ON DELETE CASCADE,
  CONSTRAINT `FK_UserPreference_ScheduleFilterUser__userPreference_id` FOREIGN KEY (`userPreference_id`) REFERENCES `UserPreference` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;